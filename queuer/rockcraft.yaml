name: etl-queuer
summary:  ETL temporal queuer app
description: |
  OCI image for ETL temporal queuer app
  The ETL queuer is responsible for creating jobs to the ETL queue for future processing.
  It generates the required params, transforms them into valid inputs and queues jobs for
  each input.
version: "1.0.1"
base: ubuntu@24.04
platforms:
  amd64:

services:
  worker:
    override: replace
    startup: disabled
    command: "./app/scripts/start-worker.sh"

parts:
  worker-deps:
    plugin: python
    source: .
    python-requirements:
      - requirements.txt
    stage-packages:
      - python3
      - python3-venv

  worker-app:
    plugin: dump
    source: .
    source-type: local
    overlay-packages:
      - bash
      - coreutils
      - curl
    override-pull: |
      craftctl default
      chmod +x scripts/start-worker.sh
    organize:
      external: app/external/
      models: app/models/
      scripts: app/scripts/
      sources: app/sources/
      worker.py: app/worker.py
      schedule.py: app/schedule.py
    prime:
      - app